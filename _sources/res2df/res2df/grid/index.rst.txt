res2df.grid
===========

.. py:module:: res2df.grid

.. autoapi-nested-parse::

   Extract grid information from grid files as Dataframes.

   Each cell in the grid correspond to one row.

   For grid cells, x, y, z for cell centre and volume is available as
   geometric information. Static data (properties) can be merged from
   the INIT file, and dynamic data can be merged from the Restart (UNRST)
   file.



Functions
---------

.. autoapisummary::

   res2df.grid.get_available_rst_dates
   res2df.grid.dates2rstindices
   res2df.grid.rst2df
   res2df.grid.gridgeometry2df
   res2df.grid.merge_initvectors
   res2df.grid.init2df
   res2df.grid.df
   res2df.grid.fill_parser
   res2df.grid.drop_constant_columns
   res2df.grid.df2res
   res2df.grid.grid_main


Module Contents
---------------

.. py:function:: get_available_rst_dates(resdatafiles: res2df.resdatafiles.ResdataFiles) -> list[datetime.date]

   Return a list of datetime objects for the available dates in the RST file


.. py:function:: dates2rstindices(resdatafiles: res2df.resdatafiles.ResdataFiles, dates: str | datetime.date | list[datetime.date] | None) -> tuple[list[int], list[datetime.date], list[str]]

   Return the restart index/indices for a given datetime or list of datetimes

     dates: datetime.date or list of datetime.date, must
         correspond to an existing date. If list, it
         forces dateinheaders to be True.
         Can also be string, then the mnenomics
         'first', 'last', 'all', are supported, or ISO
         date formats. If None or empty string is supplied,
         an empty return tuple is returned.

   Raises exception if no dates are not found.

   Return: tuple, first element is
       list of integers, corresponding to restart indices. Length 1 or more.
       second element is list of corresponding datetime.date objecs, third
       is an ISO-8601 representation of the dates.


.. py:function:: rst2df(resdatafiles: res2df.resdatafiles.ResdataFiles, date: str | datetime.date | list[datetime.date], vectors: str | list[str] | None = None, dateinheaders: bool = False, stackdates: bool = False) -> pandas.DataFrame

   Return a dataframe with dynamic data from the restart file
   for each cell, at a particular date.

   The dataframe will have a dummy index. The column named
   "active" refers to the active cell index, and is to be used
   when merging with the grid geometry dataframe.

   :param resdatafiles: ResdataFiles object
   :param date:
                datetime.date or list of datetime.date, must
                   correspond to an existing date. If list, it
                   forces dateinheaders to be True.
                   Can also be string, then the mnenomics
                   'first', 'last', 'all', are supported, or ISO
                   date formats.
                vectors: List of vectors to include,
                   glob-style wildcards supported
                dateinheaders: boolean on whether the date should
                   be added to the column headers. Instead of
                   SGAS as a column header, you get SGAS@YYYY-MM-DD.
                stackdates: Default is false. If True, a column
                   called DATE will be added and data for all restart
                   dates will be added in a stacked manner. Implies
                   dateinheaders False.


.. py:function:: gridgeometry2df(resdatafiles: res2df.resdatafiles.ResdataFiles, zonemap: dict[int, str] | None = None) -> pandas.DataFrame

   Produce a Pandas Dataframe with grid geometry

   Order is significant, and is determined by the order from resdata, and used
   when merging with other dataframes with cell-data.

   :param resdatafiles: object holding the :term:`output files <output file>`.
   :param zonemap: A zonemap dictionary mapping every K index to a
                   string, which will be put in a column ZONE. If none is provided,
                   a zonemap from a default file will be looked for. Provide an empty
                   dictionary to avoid looking for the default file, and no ZONE
                   column will be added.

   :returns: DataFrame with at least the columns I, J, K, X, Y, Z and VOLUME. One row
             pr. cell. The index of the dataframe are the global indices. If a zonemap
             is provided, zone information will be in the column ZONE.


.. py:function:: merge_initvectors(resdatafiles: res2df.resdatafiles.ResdataFiles, dframe: pandas.DataFrame, initvectors: list[str], ijknames: list[str] | None = None) -> pandas.DataFrame

   Merge in INIT vectors to a dataframe by I, J, K.

   Utility function for other modules to use. Normally it is sufficient
   for API users to only use the df() function.

   :param resdatafiles: Object representing the :term:`output files <output file>`
   :param dframe: Table data to merge with
   :param initvectors: Names of INIT vectors to merge in.
   :param ijknames: Three strings that determine the I, J and K columns to use
                    for merging in dframe. For compdat the 'K' is f.ex. denoted 'K1'

   :returns: Copy of incoming dataframe with additional columns


.. py:function:: init2df(resdatafiles: res2df.resdatafiles.ResdataFiles, vectors: str | list[str] | None = None) -> pandas.DataFrame

   Extract information from INIT file with cell data

   Normally, you would use the df() function which will
   call this function on your behalf.

   Order is significant, as index is used for merging

   :param resdatafiles: Object that can serve the EGRID and INIT files
   :param vectors: List of vectors to include,
                   glob-style wildcards supported.


.. py:function:: df(resdatafiles: res2df.resdatafiles.ResdataFiles, vectors: str | list[str] = '*', dropconstants: bool = False, rstdates: str | datetime.date | list[datetime.date] | None = None, dateinheaders: bool = False, stackdates: bool = False, zonemap: dict[int, str] | None = None) -> pandas.DataFrame

   Produce a dataframe with grid information

   Grid information (center coordinates x, y, z), cell
   indices (i, j, k) (indices follow the Eclipse convention starting
   at 1, not zero as in resdata), properties from INIT, and optionally
   any time dependent data from Restart files.

   :param resdatafiles: Handle to a simulator case
   :param vectors: Vectors to include, wildcards
                   supported. Used to match both
                   INIT vectors and RESTART vectors.
   :param dropconstants: If true, columns that are constant
                         for every cell are dropped.
   :type dropconstants: bool
   :param rstdates: Restart dates to include in ISO-8601 format.
                    Alternatively, pick from the mnenomics 'first', 'all' and 'last'.
   :param dateinheaders: Whether columns with data from UNRST files
                         should always have the ISO-date embedded in the column header.
   :param stackdates: Default is false. If true, a column
                      called DATE will be added and data for all restart
                      dates will be added in a stacked manner. Implies
                      dateinheaders False.
   :param zonemap: A zonemap dictionary mapping every K index to a
                   string, which will be put in a column ZONE. If none is provided,
                   a zonemap from a default file will be looked for. Provide an empty
                   dictionary to avoid looking for the default file, and no ZONE
                   column will be added.


.. py:function:: fill_parser(parser: argparse.ArgumentParser) -> argparse.ArgumentParser

   Set up sys.argv parser.

   :param parser: argparse.ArgumentParser or argparse.subparser


.. py:function:: drop_constant_columns(dframe: pandas.DataFrame, alwayskeep: str | list[str] | None = None) -> pandas.DataFrame

   Drop/delete constant columns from a dataframe.

   :param dframe:
   :param alwayskeep: string or list of strings of columns to keep
                      anyway.

   :returns: Dataframe with equal or less columns.


.. py:function:: df2res(grid_df: pandas.DataFrame, keywords: str | list[str], resdatafiles: res2df.resdatafiles.ResdataFiles | None = None, dtype: type | None = None, filename: str | None = None, nocomments: bool = False) -> str

   Write a :term:`include file` contents with grid data keyword, like PERMX, PORO,
   FIPNUM etc, for the GRID section of the :term:`.DATA file`.

   Output (returned as string and optionally written to file) will then
   contain f.ex::

       PERMX
          3.3 4.1 500.1 8543.0 1223.0 5022.0
          411.455 4433.9
       /

   if the grid contains 8 cells (inactive and active).

   :param grid_df: Dataframe with the keyword for which
                   we want to export data, and also the a column with GLOBAL_INDEX.
                   Without GLOBAL_INDEX, the output will likely be invalid.
                   The grid can contain both active and inactive cells.
   :param keywords: The keyword(s) to export, with one
                    value for every cell.
   :param resdatafiles: If provided, the total cell count for the grid
                        will be requested from this object. If not, it will be *guessed*
                        from the maximum number of GLOBAL_INDEX, which can be under-estimated
                        in the corner-case that the last cells are inactive.
   :param dtype: If provided, the columns which are
                 outputted are converted to int or float. Dataframe columns
                 read from CSV files easily gets the wrong type, while Eclipse
                 might require some data to be strictly integer.
   :param filename: If provided, the string produced will also to be
                    written to this filename.
   :param nocomments: Set to True to avoid any comments being written. Defaults
                      to False.


.. py:function:: grid_main(args: argparse.Namespace) -> None

   This is the command line API


